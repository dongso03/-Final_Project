<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시물 상세 페이지</title>
</head>
<body>
	<h1>게시물 상세 페이지</h1>
	<div id="postDetail"></div>
	<input type="hidden" id="nickname" value="nickname">
	<input type="hidden" id="post_id" value="post_id">
	<input type="button" value="채팅방 참여" onclick="chatWinOpen()">
	<script>
	//수정 필요
	const postDetail = document.getElementById("postDetail");
	var urlParams = new URLSearchParams(window.location.search);
	var post_Id = urlParams.get('post_Id'); // URL 파라미터에서 post_Id를 가져옵니다.
	console.log(post_Id);
	const apiURL = `http://localhost:8080/post/detail?post_Id=${post_Id}`;
     //?post_Id=${post_Id}
        // 서블릿 엔드포인트를 호출하여 JSON 데이터를 가져옵니다.
        
    let chatWindow = null;
    
    function chatWinOpen() {
        const nickname = document.getElementById("nickname").value; // 사용자의 닉네임 가져오기
        if (!chatWindow || chatWindow.closed) {
            const url = "ChatWindow?nickname=" + nickname + "&post_Id=" + post_Id; // URL에 닉네임과 게시물 ID 추가
            chatWindow = window.open(url, "", "width=400, height=450"); // 채팅 창 열기
        } else {
            chatWindow.focus();
        }
    }

        
        
        fetch(apiURL,{
            method: 'POST' })
            .then((resp)=> resp.json())
            .then((data) => {
            	// 첫 번째 객체의 'user' 필드에서 'id' 값 가져오기
            	const userId = data[1].id;
				
            	// 두 번째 객체의 'post' 필드에서 'content' 값 가져오기
            	const postContent = data[0].content;
				
            	// HTML에 가져온 값을 추가하기
            	let userIdParagraph = document.createElement("p");
            	userIdParagraph.innerText = `사용자 ID: ${userId}`;
            	postDetail.appendChild(userIdParagraph);

            	let postContentParagraph = document.createElement("p");
            	postContentParagraph.innerText = `게시물 내용: ${postContent}`;
            	postDetail.appendChild(postContentParagraph);

            	
            /* 	let p = document.createElement("p");
                p.innerText = `ID: ${data.user.id}`;
                postDetail.appendChild(p);
                let p2 = document.createElement("p");
                p2.innerText = `내용: ${data.post.content}`;
                postDetail.appendChild(p2); */
            	
            	/* data.forEach((item) => {
            		let p = document.createElement("p");
	                p.innerText = `ID: ${item.id}`;
	                postDetail.appendChild(p);
	                let p2 = document.createElement("p");
	                p2.innerText = `내용: ${item.content}`;
	                postDetail.appendChild(p2);
            	 }); */
            	 
            });
    </script>
</body>
</html>
